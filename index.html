<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <!-- Prevent browser HTTP caching of this HTML page.
         GitHub Pages sets Cache-Control: max-age=600 (10 min). During that window,
         a stale cached HTML file may reference old JS chunk hashes that no longer exist
         on the server, causing "Loading the realm..." to hang forever.
         These meta tags tell the browser to always revalidate this page. -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>Guild Life</title>
    <meta name="description" content="A fantasy life simulation game inspired by Jones in the Fast Lane">
    <meta name="author" content="Guild Life Adventures" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2e1f0f" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Guild Life" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />

    <!-- Google Fonts - loaded as <link> instead of CSS @import to avoid render-blocking -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />

    <!-- Open Graph -->


    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="og:title" content="Guild Life">
  <meta name="twitter:title" content="Guild Life">
  <meta property="og:description" content="A fantasy life simulation game inspired by Jones in the Fast Lane">
  <meta name="twitter:description" content="A fantasy life simulation game inspired by Jones in the Fast Lane">
</head>

  <body>
    <div id="root">
      <!-- Loading screen — visible until React mounts and replaces this content -->
      <div id="loading-screen" style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#1f170a;color:#e8dcc8;font-family:serif;text-align:center;padding:2rem;">
        <h1 style="font-size:2rem;margin-bottom:1rem;color:#d4a537;">Guild Life Adventures</h1>
        <p style="font-size:1rem;opacity:0.7;">Loading the realm...</p>
        <noscript><p style="margin-top:1rem;color:#c44;">JavaScript is required to play this game.</p></noscript>
      </div>
    </div>
    <!-- Catch JS errors that occur before React mounts (module load failures, etc.) -->
    <script>
      window.__guildLoadErrors=[];
      function __guildShowLoadError(msg){
        setTimeout(function(){
          var ls=document.getElementById('loading-screen');
          if(!ls)return;
          if(ls.querySelector('.error-info'))return;
          var d=document.createElement('div');
          d.className='error-info';
          d.style.cssText='margin-top:1rem;';
          d.innerHTML='<p style="color:#c44;font-size:0.95rem;">Failed to load the realm</p>'
            +'<p style="font-size:0.8rem;opacity:0.7;max-width:500px;word-break:break-word;">'+msg+'</p>'
            +'<button onclick="location.reload()" style="margin-top:1rem;padding:.5rem 1.5rem;background:#d4a537;color:#1f170a;border:none;border-radius:4px;cursor:pointer;font-size:1rem;">Reload</button>';
          ls.appendChild(d);
        },3000);
      }
      window.onerror=function(msg,src,line,col,err){
        window.__guildLoadErrors.push({msg:msg,src:src,err:err});
        __guildShowLoadError(msg);
      };
      /* ES module loading failures produce rejected promises, not synchronous errors.
         Without this handler, the loading screen stays visible forever with no error shown. */
      window.addEventListener('unhandledrejection',function(e){
        var msg=e.reason&&e.reason.message?e.reason.message:String(e.reason||'Module loading failed');
        window.__guildLoadErrors.push({msg:msg,err:e.reason});
        __guildShowLoadError(msg);
      });
    </script>
    <script type="module" src="/src/main.tsx"></script>
    <!-- Fallback: polling loop checks every 3s if React has mounted.
         If loading-screen is still visible after 4s, shows "Clear Cache & Reload" button.
         Continues polling in case the first check fires during the pre-mount version check.
         The button unregisters SWs, clears all caches, waits 300ms, then reloads. -->
    <script>
      (function(){
        var shown=false;
        function guildFallbackCheck(){
          var root=document.getElementById('root');
          var ls=root&&root.querySelector('#loading-screen');
          if(!ls){shown=true;return;} /* React mounted — stop checking */
          if(shown)return; /* Already showed button */
          shown=true;
          var p=document.createElement('p');
          p.className='fallback-btn';
          p.style.cssText='margin-top:1.5rem;font-family:serif;';
          p.innerHTML='<button onclick="(function(){if(navigator.serviceWorker){navigator.serviceWorker.getRegistrations().then(function(r){r.forEach(function(s){s.unregister()})});}if(window.caches){caches.keys().then(function(n){n.forEach(function(k){caches.delete(k)})});}setTimeout(function(){location.reload()},300);})()" style="padding:.75rem 2rem;font-size:1rem;font-family:serif;background:linear-gradient(135deg,hsl(45,85%,55%),hsl(35,70%,40%));color:#1f170a;border:none;border-radius:.25rem;cursor:pointer;font-weight:bold;">Clear Cache &amp; Reload</button>';
          ls.appendChild(p);
        }
        /* Poll every 3s starting at 4s. The pre-mount version check in main.tsx takes
           up to 3s (fetch timeout), so we wait 4s to avoid false positives. */
        var t=setInterval(function(){
          var root=document.getElementById('root');
          var ls=root&&root.querySelector('#loading-screen');
          if(!ls){clearInterval(t);return;} /* React mounted */
          guildFallbackCheck();
        },3000);
        /* First check at 4s (after version check timeout + some margin) */
        setTimeout(guildFallbackCheck,4000);
      })();
    </script>
  </body>
</html>
